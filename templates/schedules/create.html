{% extends "base.html" %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Create New Schedule</h3>
        </div>
        <div class="card-body">
          <form method="POST" id="scheduleForm">
            <div class="form-group">
              <label for="name">Schedule Name *</label>
              <input type="text" class="form-control" id="name" name="name" 
                     placeholder="Enter schedule name (3-50 characters, no spaces)" 
                     pattern="[a-zA-Z0-9_.-]+" title="Only letters, numbers, underscores, hyphens, and periods are allowed"
                     required minlength="3" maxlength="50">
              <small class="form-text text-muted">
                Schedule name must be between 3 and 50 characters long. Only letters, numbers, underscores (_), hyphens (-), and periods (.) are allowed. No spaces.
              </small>
            </div>
            
            <div class="form-group">
              <label for="description">Description</label>
              <textarea class="form-control" id="description" name="description" 
                        rows="3" placeholder="Enter schedule description (optional)"></textarea>
              <small class="form-text text-muted">
                Optional description for this schedule.
              </small>
            </div>
            
            <hr>
            
            <!-- Timeframes Section -->
            <div class="form-group">
              <h5>Timeframes</h5>
              <p class="text-muted">Define when this schedule is active. Each timeframe can be enabled for specific days of the week.</p>
              
              <div id="timeframesContainer">
                <!-- Timeframes will be added here dynamically -->
              </div>
              
              <button type="button" class="btn btn-primary" id="addTimeframe">
                <i class="fas fa-plus"></i> Add Timeframe
              </button>
            </div>
            
            <hr>
            
            <div class="form-group">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Create Schedule
              </button>
              <a href="{{ url_for('schedules.schedules_list') }}" class="btn btn-secondary">
                <i class="fas fa-times"></i> Cancel
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
let timeframeCounter = 0;

document.getElementById('addTimeframe').addEventListener('click', function() {
  const container = document.getElementById('timeframesContainer');
  const newTimeframe = document.createElement('div');
  newTimeframe.className = 'timeframe-panel card mb-3';
  newTimeframe.setAttribute('data-timeframe-id', timeframeCounter);
  
  newTimeframe.innerHTML = `
    <div class="card-header">
      <h6 class="mb-0">Timeframe ${timeframeCounter + 1}</h6>
      <button type="button" class="btn btn-sm btn-danger float-right remove-timeframe">
        <i class="fas fa-trash"></i> Remove
      </button>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <label>Days of Week</label>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="timeframes[${timeframeCounter}][days][monday]" value="0">
            <label class="form-check-label">Monday</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="timeframes[${timeframeCounter}][days][tuesday]" value="1">
            <label class="form-check-label">Tuesday</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="timeframes[${timeframeCounter}][days][wednesday]" value="2">
            <label class="form-check-label">Wednesday</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="timeframes[${timeframeCounter}][days][thursday]" value="3">
            <label class="form-check-label">Thursday</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="timeframes[${timeframeCounter}][days][friday]" value="4">
            <label class="form-check-label">Friday</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="timeframes[${timeframeCounter}][days][saturday]" value="5">
            <label class="form-check-label">Saturday</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="timeframes[${timeframeCounter}][days][sunday]" value="6">
            <label class="form-check-label">Sunday</label>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <label for="start_time_${timeframeCounter}">Start Time</label>
            <input type="time" class="form-control" id="start_time_${timeframeCounter}" 
                   name="timeframes[${timeframeCounter}][start_time]" required>
          </div>
          <div class="form-group">
            <label for="end_time_${timeframeCounter}">End Time</label>
            <input type="time" class="form-control" id="end_time_${timeframeCounter}" 
                   name="timeframes[${timeframeCounter}][end_time]" required>
          </div>
        </div>
      </div>
    </div>
  `;
  
  container.appendChild(newTimeframe);
  timeframeCounter++;
});

// Handle remove timeframe buttons
document.addEventListener('click', function(e) {
  if (e.target.classList.contains('remove-timeframe') || e.target.closest('.remove-timeframe')) {
    const timeframePanel = e.target.closest('.timeframe-panel');
    if (timeframePanel) {
      timeframePanel.remove();
    }
  }
});
</script>
{% endblock %} 