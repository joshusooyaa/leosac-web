{% extends "base.html" %}

{% block title %}Schedules - Leosac Web GUI{% endblock %}
{% block page_title %}Schedules{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Schedules</h3>
          <div class="card-tools">
            <a href="{{ url_for('schedules_create') }}" class="btn btn-primary">
              <i class="fas fa-plus"></i> Create Schedule
            </a>
          </div>
        </div>
        <div class="card-body">
          {% if schedules %}
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>#ID</th>
                    <th>Name</th>
                    <th>Description</th>
                    <th>Timeframes</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for schedule in schedules %}
                    <tr>
                      <td>
                        <a href="{{ url_for('schedule_view', schedule_id=schedule.id) }}">{{ schedule.id }}</a>
                      </td>
                      <td>
                        <a href="{{ url_for('schedule_view', schedule_id=schedule.id) }}">{{ schedule.name }}</a>
                      </td>
                      <td>{{ schedule.description or 'No description' }}</td>
                      <td>
                        {% if schedule.timeframes %}
                          {{ schedule.timeframes|length }} timeframe(s)
                        {% else %}
                          <span class="text-muted">No timeframes</span>
                        {% endif %}
                      </td>
                      <td>
                        <div class="btn-group" role="group">
                          <a href="{{ url_for('schedule_view', schedule_id=schedule.id) }}" 
                             class="btn btn-sm btn-info">
                            <i class="fas fa-eye"></i> View
                          </a>
                          <a href="{{ url_for('schedule_edit', schedule_id=schedule.id) }}" 
                             class="btn btn-sm btn-warning">
                            <i class="fas fa-edit"></i> Edit
                          </a>
                          <button type="button" class="btn btn-sm btn-danger" 
                                  onclick="confirmDelete({{ schedule.id }}, '{{ schedule.name }}')">
                            <i class="fas fa-trash"></i> Delete
                          </button>
                        </div>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="alert alert-info">
              <i class="fas fa-info-circle"></i> No schedules found. 
              <a href="{{ url_for('schedules_create') }}">Create your first schedule</a>.
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Delete</h5>
        <button type="button" class="close" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete the schedule "<span id="scheduleName"></span>"?</p>
        <p class="text-danger"><strong>This action cannot be undone.</strong></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <form id="deleteForm" method="POST" style="display: inline;">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
function confirmDelete(scheduleId, scheduleName) {
  document.getElementById('scheduleName').textContent = scheduleName;
  document.getElementById('deleteForm').action = '/schedules/' + scheduleId + '/delete';
  $('#deleteModal').modal('show');
}
</script>
{% endblock %} 